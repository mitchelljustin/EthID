<div class="row">
    <div class="jumbotron col-sm-10 col-sm-push-1">
        <h2 class="text-center">Your Ethereum Identity</h2>
        <h3>
            {{ profile.email }}
            <small>
                {{ profile.name }}
            </small>
        </h3>
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>
                        Address
                    </th>
                    <th>
                        Type
                    </th>
                    <th>
                        Actions
                    </th>
                </tr>
            </thead>
            {{#each identities}}
                <tr id="{{ ethereumAddress }}">
                    <td>
                        {{ ethereumAddress }}
                    </td>
                    <td>
                        {{ identityType }}
                    </td>
                    <td class='_button_bar'>
                        {{#if verified}}
                            <span>Verified</span>
                        {{ else }}
                            <button class="btn btn-danger _reject">
                                Reject
                            </button>
                            <button class="btn btn-success _approve">
                                Approve
                            </button>
                        {{/if}}
                    </td>
                </tr>
            {{/each}}
        </table>
    </div>
</div>

<script>
    var ethAddrs = [
        {{#each identities}}
            "{{ ethereumAddress }}",
        {{/each}}
    ];
    ethAddrs.forEach(function (ethAddr) {
        let $row = $('#' + ethAddr);
        $row.find('._button_bar ._reject').on('click', function () {
            $.ajax({
                method: 'POST',
                url: '/identity/reject',
                data: {ethereumAddress: ethAddr, emailAddress: "{{ profile.email }}"}
            })
                .done(function () {
                    $row.remove();
                });
        });
        $row.find('._button_bar ._approve').on('click', function () {
            $.ajax({
                method: 'POST',
                url: '/identity/approve',
                data: {ethereumAddress: ethAddr, emailAddress: "{{ profile.email }}"}
            })
                .done(function () {
                    $row.find('._button_bar').html('<span>Verified</span>');
                });
        });
    });
</script>